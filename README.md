Telechor
====

## Description
Telechorはオンラインで合唱をすることを目的に作られたアプリでした。即時性を上げることのみを目的とし、音質の向上などは一切行っていません。
それでも外部との通信では遅延が大きくて使えませんでした。

## 環境
ソケット通信にsocket.hを用いているので、MacかLinuxを想定しています。いずれWindowsにも対応させたい。
また[SoX](http://sox.sourceforge.net/)というアプリが必要になります。Linuxならaptなどから、Macなら[Homebrew](https://brew.sh/index_ja)などから入手しましょう。

## インストール
makeするだけです。serverとclientという2つのファイルが出来ます。

## 利用方法
サーバを起動するユーザは自分のグローバルIPアドレスを調べておき、serverを実行します。引数などは何も取りません。
グローバルIPアドレスを調べるには、確認くん(https://www.ugtop.com/spill.shtml)などを利用すれば良いです。ルータを使っていないなら、ifconfigコマンドで調べても良いでしょう。
サーバが実行されたら、クライアントは接続を開始します。clientを直接実行するのではなく、client.shを経由して実行して下さい。引数にはサーバのグローバルIPアドレスを取ります。
クライアントは*必ず*イヤホン等を使用して下さい。何の対策もしていないのでハウリングが凄いです。
サーバ自体には通話機能は有りません。サーバ管理者が参加したい場合、クライアントを起動して127.0.0.1に接続して下さい。

## 利用上の注意
サーバではクライアント毎に子プロセスを作っています。プログラム上ではMAX\_PARTICIPANTSを100としていますが、あまり多くするとCPUの利用率が相当上昇します。
遅延が生じる際には、クライアントの再接続を試してみて下さい。
また気をつけてはいますが、通信を終了してもserverの子プロセスが生き残ってしまったり、shm.hで作った共有メモリが削除されなかったりする可能性があります。プロセスについては
    $ ps aux | grep /server
でプロセス番号を調べ、killコマンドで殺して下さい。
共有メモリについては、`ipcs`コマンドで調べ、Shared Memory:にメモリが残っていたら、
    $ ipcrm -m (メモリのID)
で削除して下さい。
